//'use strict';

//var callBind = require('call-bind');
//var define = require('define-properties');
//var RequireObjectCoercible = require('es-abstract/2022/RequireObjectCoercible');

//var implementation = require('./implementation');
//var getPolyfill = require('./polyfill');
//var shim = require('./shim');

//var bound = callBind(getPolyfill());
//var boundMethod = function trim(receiver) {
//	RequireObjectCoercible(receiver);
//	return bound(receiver);
//};

//define(boundMethod, {
//	getPolyfill: getPolyfill,
//	implementation: implementation,
//	shim: shim
//});

//module.exports = boundMethod; /


// Подключаем библиотеку для работы с Telegram API в переменную
var TelegramBot = require('node-telegram-bot-api');

// Устанавливаем токен, который выдавал нам бот
var token = '6078565060:AAFP_g-Zepp8LFbPymmUbmNSR2P9jaO5XUM';
// Включить опрос сервера. Бот должен обращаться к серверу Telegram, чтобы получать актуальную информацию
// Подробнее: https://core.telegram.org/bots/api#getupdates
var bot = new TelegramBot(token, { polling: true });

var notes = [];

bot.onText(/напомни (.+) в (.+)/, function (msg, match) {
	var userId = msg.from.id;
	var text = match[1];
	var time = match[2];

	notes.push({ 'uid': userId, 'time': time, 'text': text });

	bot.sendMessage(userId, 'Отлично! Я обязательно напомню, если не сдохну :)');
});

setInterval(function(){
	for (var i = 0; i < notes.length; i++) {
    const curDate = new Date().getHours() + ':' + new Date().getMinutes();
    if (notes[i]['time'] === curDate) {
      bot.sendMessage(notes[i]['uid'], 'Напоминаю, что вы должны: '+ notes[i]['text'] + ' сейчас.');
      notes.splice(i, 1);
    }
  }
}, 1000);
